<!doctype html><html lang="ru"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Оплата прошла — OtmyvVPN</title>
<link rel="stylesheet" href="/assets/styles.css">
<script>
  window.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(location.search);
    const orderId = params.get('orderId');
    const backend = params.get('backend') || (window.OTMYV_BACKEND || '');
    if(!orderId || !backend){
      document.getElementById('msg').textContent = 'Нет данных заказа. Обратитесь в поддержку.';
      return;
    }
    try {
      const r = await fetch(backend.replace(/\/$/,'') + '/api/get-config?orderId=' + encodeURIComponent(orderId));
      if(!r.ok){ throw new Error('bad status'); }
      const data = await r.json();
      if(data && data.configText){
        const blob = new Blob([data.configText], {type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.getElementById('download');
        a.href = url;
        a.download = 'otmyvvpn.conf';
        a.style.display='inline-block';
        document.getElementById('msg').textContent = 'Скачайте конфигурацию и импортируйте в WireGuard.';
      } else {
        document.getElementById('msg').textContent = 'Конфигурация недоступна. Напишите в поддержку.';
      }
    } catch(e){
      document.getElementById('msg').textContent = 'Ошибка запроса к backend.';
    }
  });
</script>
</head><body>
<div class="container">
  <h2>Оплата успешно выполнена</h2>
  <div class="card">
    <p id="msg">Готовим конфигурацию…</p>
    <a id="download" class="btn btn-primary" style="display:none">Скачать конфиг (WireGuard)</a>
    <p class="small">Как импортировать: установите приложение WireGuard → Импорт → выберите файл.</p>
  </div>
  <a class="btn" href="/index.html">На главную</a>
</div>
</body></html>